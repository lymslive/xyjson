<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ site.title }}{% if page.title %} - {{ page.title }}{% endif %}</title>
  
  <!-- GitHub Markdown CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
  
  <!-- Highlight.js for code syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  
  <style>
    .container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      gap: 24px;
    }
    
    .sidebar {
      width: 250px;
      flex-shrink: 0;
      position: sticky;
      top: 20px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
    }
    
    .main-content {
      flex: 1;
      min-width: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #24292f;
      background-color: #ffffff;
    }
    
    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 100%;
      margin: 0;
      padding: 0;
    }
    
    @media (max-width: 992px) {
      .container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        position: static;
        max-height: none;
      }
    }
    
    @media (max-width: 767px) {
      body {
        padding: 15px;
      }
      
      .markdown-body {
        padding: 15px;
      }
    }
    
    .header {
      border-bottom: 1px solid #d1d9e0;
      padding-bottom: 16px;
      margin-bottom: 24px;
    }
    
    .header h1 {
      margin: 0;
      font-size: 2.5em;
      color: #0969da;
    }
    
    .header p {
      margin: 8px 0 0 0;
      color: #656d76;
      font-size: 1.1em;
    }
    
    .nav {
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .nav ul {
      margin: 0;
      padding: 0;
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .nav a {
      color: #0969da;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .nav a:hover {
      background-color: #ddf4ff;
      text-decoration: none;
    }
    
    .nav a.active {
      background-color: #0969da;
      color: white;
    }
    
    .toc {
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 24px;
    }
    
    .toc h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.1em;
      color: #24292f;
    }
    
    .toc ul {
      margin: 0;
      padding-left: 0;
      list-style: none;
    }
    
    .toc li {
      margin: 4px 0;
    }
    
    .toc a {
      color: #0969da;
      text-decoration: none;
      font-size: 0.9em;
      display: block;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .toc a:hover {
      background-color: #ddf4ff;
      text-decoration: none;
    }
    
    .toc .toc-level-1 {
      font-weight: 600;
      margin-left: 0;
    }
    
    .toc .toc-level-2 {
      margin-left: 16px;
      font-weight: normal;
    }
    
    .toc .toc-level-3 {
      margin-left: 32px;
      font-weight: normal;
      font-size: 0.85em;
    }
    
    .toc .toc-level-4 {
      margin-left: 48px;
      font-weight: normal;
      font-size: 0.8em;
    }
    
    .toc .active {
      background-color: #0969da;
      color: white;
    }
    
    .footer {
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid #d1d9e0;
      text-align: center;
      color: #656d76;
      font-size: 0.9em;
    }
    
    .footer a {
      color: #0969da;
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
    
    /* 代码高亮 */
    pre, code {
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    }
    
    .markdown-body pre {
      background-color: #f6f8fa;
      border-radius: 6px;
      padding: 16px;
      overflow: auto;
    }
    
    .markdown-body code {
      background-color: rgba(175, 184, 193, 0.2);
      padding: 0.2em 0.4em;
      border-radius: 6px;
      font-size: 85%;
    }
    
    .markdown-body pre code {
      background-color: transparent;
      padding: 0;
    }
    
    /* 表格样式 */
    .markdown-body table {
      border-collapse: collapse;
      width: 100%;
    }
    
    .markdown-body table th,
    .markdown-body table td {
      border: 1px solid #d0d7de;
      padding: 8px 12px;
      text-align: left;
    }
    
    .markdown-body table th {
      background-color: #f6f8fa;
      font-weight: 600;
    }
    
    /* 引用样式 */
    .markdown-body blockquote {
      border-left: 4px solid #d0d7de;
      padding: 0 16px;
      margin: 0;
      color: #656d76;
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
      .nav ul {
        flex-direction: column;
        gap: 8px;
      }
      
      .markdown-body {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>xyjson</h1>
    <p>基于 yyjson 的 C++ 封装库，支持操作符重载的 JSON 操作</p>
  </div>
  
  <div class="nav">
    <ul>
      <li><a href="{{ site.baseurl }}/" {% if page.url == '/' %}class="active"{% endif %}>首页</a></li>
      <li><a href="{{ site.baseurl }}/docs/api.html" {% if page.url contains 'docs/api' %}class="active"{% endif %}>API 文档</a></li>
      <li><a href="{{ site.baseurl }}/docs/usage.html" {% if page.url contains 'docs/usage' %}class="active"{% endif %}>使用指南</a></li>
      <li><a href="{{ site.baseurl }}/docs/design.html" {% if page.url contains 'docs/design' %}class="active"{% endif %}>设计思想</a></li>
    </ul>
  </div>
  
  <div class="container">
    <!-- 侧边栏 TOC -->
    <div class="sidebar">
      {% if page.toc %}
      <div class="toc">
        <h3>目录</h3>
        <div id="table-of-contents">
          <!-- TOC will be generated by JavaScript -->
        </div>
      </div>
      {% endif %}
    </div>
    
    <!-- 主内容区域 -->
    <div class="main-content">
      <article class="markdown-body">
        {{ content }}
      </article>
    </div>
  </div>
  
  <div class="footer">
    <p>
      <a href="https://github.com/lymslive/xyjson">xyjson</a> - 
      Documentation generated by 
      <a href="https://jekyllrb.com/">Jekyll</a>
    </p>
    <p>
      © {{ site.time | date: "%Y" }} {{ site.author }}
    </p>
  </div>
  
  <script>
    // 初始化代码高亮
    hljs.highlightAll();
    
    // 设置导航活动状态
    document.addEventListener('DOMContentLoaded', function() {
      const currentPath = window.location.pathname;
      const navLinks = document.querySelectorAll('.nav a');
      
      navLinks.forEach(link => {
        if (link.getAttribute('href') === currentPath) {
          link.classList.add('active');
        }
      });
      
      // 自动生成目录
      generateTOC();
      
      // 修复中文换行空格
      fixChineseLineBreakSpaces();
      
      // 设置目录高亮和滚动监听
      setupTOCScrolling();
    });
    
    // 修复中文换行导致的空格问题
    function fixChineseLineBreakSpaces() {
      const content = document.querySelector('.markdown-body');
      if (!content) return;
      
      // 获取所有文本节点
      const walker = document.createTreeWalker(
        content,
        NodeFilter.SHOW_TEXT,
        null,
        false
      );
      
      const textNodes = [];
      let node;
      while (node = walker.nextNode()) {
        // 跳过代码块和行内代码
        const parent = node.parentElement;
        if (parent && (parent.tagName === 'CODE' || 
                      parent.tagName === 'PRE' || 
                      parent.classList.contains('highlight'))) {
          continue;
        }
        textNodes.push(node);
      }
      
      // 处理每个文本节点
      textNodes.forEach(textNode => {
        let text = textNode.nodeValue;
        
        // 修复换行导致的中文文本中的多余空格
        text = text.replace(/([\u4e00-\u9fff])\s+([\u4e00-\u9fff])/g, '$1$2');
        
        // 修复中文标点符号与汉字之间的多余空格
        text = text.replace(/([，。！？；：""''（）【】《》])\s+([\u4e00-\u9fff])/g, '$1$2');
        text = text.replace(/([\u4e00-\u9fff])\s+([，。！？；：""''（）【】《》])/g, '$1$2');
        
        textNode.nodeValue = text;
      });
      
      // 额外处理：合并相邻的文本节点之间可能的问题
      const paragraphs = content.querySelectorAll('p, li, td');
      paragraphs.forEach(element => {
        let html = element.innerHTML;
        // 处理标签之间的空格问题
        html = html.replace(/>([\u4e00-\u9fff])<\/(\w+)>[\s]*<\2>([\u4e00-\u9fff])</g, '>$1</$2><$2>$3');
        element.innerHTML = html;
      });
    }
    
    function generateTOC() {
      const tocContainer = document.getElementById('table-of-contents');
      if (!tocContainer) return;
      
      const content = document.querySelector('.markdown-body');
      if (!content) return;
      
      const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
      if (headings.length === 0) return;
      
      let tocHTML = '<ul class="toc-list">';
      
      headings.forEach((heading, index) => {
        const level = parseInt(heading.tagName.substring(1));
        const id = heading.id || `heading-${index}`;
        heading.id = id;
        
        const text = heading.textContent.trim();
        const tocClass = `toc-level-${Math.min(level - 1, 4)}`;
        
        tocHTML += `<li class="${tocClass}"><a href="#${id}" data-level="${level}">${text}</a></li>`;
      });
      
      tocHTML += '</ul>';
      tocContainer.innerHTML = tocHTML;
    }
    
    function setupTOCScrolling() {
      const tocLinks = document.querySelectorAll('.toc a');
      const headings = document.querySelectorAll('.markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6');
      
      if (tocLinks.length === 0) return;
      
      // 点击目录项时的处理
      tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            const offset = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
            window.scrollTo({ top: offset, behavior: 'smooth' });
            
            // 更新活动状态
            tocLinks.forEach(l => l.classList.remove('active'));
            this.classList.add('active');
          }
        });
      });
      
      // 滚动时更新目录高亮
      function updateActiveTOC() {
        const scrollPosition = window.pageYOffset + 150;
        
        let activeHeading = null;
        headings.forEach(heading => {
          if (heading.offsetTop <= scrollPosition) {
            activeHeading = heading;
          }
        });
        
        if (activeHeading) {
          tocLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${activeHeading.id}`) {
              link.classList.add('active');
            }
          });
        }
      }
      
      // 节流函数
      function throttle(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }
      
      window.addEventListener('scroll', throttle(updateActiveTOC, 100));
    }
  </script>
</body>
</html>
